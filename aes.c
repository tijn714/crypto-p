#include <stdio.h>

#include "aes.h"
#include "stsio.h"

#define LONG_SIZE 128


void TestCase(void) {
  uint8_t tc_key[32] = 
  {
    0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6,
    0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c,
    0xa0, 0xfa, 0xfe, 0x17, 0x88, 0x54, 0x2c, 0xb1,
    0x23, 0xa3, 0x39, 0x39, 0x2a, 0x6c, 0x76, 0x05
  };

  uint8_t tc_in[LONG_SIZE] = 
  {
    0x48, 0x65, 0x6c, 0x6c, 0x6f, 0x2c, 0x20, 0x57,
    0x6f, 0x72, 0x6c, 0x64, 0x21, 0x48, 0x65, 0x6c,
    0x6c, 0x6f, 0x2c, 0x20, 0x57, 0x6f, 0x72, 0x6c,
    0x64, 0x21, 0x48, 0x65, 0x6c, 0x6c, 0x6f, 0x2c,
    0x20, 0x57, 0x6f, 0x72, 0x6c, 0x64, 0x21, 0x48,
    0x65, 0x6c, 0x6c, 0x6f, 0x2c, 0x20, 0x57, 0x6f,
    0x72, 0x6c, 0x64, 0x21, 0x48, 0x65, 0x6c, 0x6c,
    0x6f, 0x2c, 0x20, 0x57, 0x6f, 0x72, 0x6c, 0x64,
    0x21, 0x48, 0x65, 0x6c, 0x6c, 0x6f, 0x2c, 0x20,
    0x57, 0x6f, 0x72, 0x6c, 0x64, 0x21, 0x48, 0x65,
    0x6c, 0x6c, 0x6f, 0x2c, 0x20, 0x57, 0x6f, 0x72,
    0x6c, 0x64, 0x21, 0x48, 0x65, 0x6c, 0x6c, 0x6f,
    0x2c, 0x20, 0x57, 0x6f, 0x72, 0x6c, 0x64, 0x21,
    0x48, 0x65, 0x6c, 0x6c, 0x6f, 0x2c, 0x20, 0x57,
    0x6f, 0x72, 0x6c, 0x64, 0x21, 0x48, 0x65, 0x6c,
    0x6c, 0x6f, 0x2c, 0x20, 0x57, 0x6f, 0x72, 0x6c
  };

  uint8_t tc_out[LONG_SIZE];
  uint8_t tc_out2[LONG_SIZE];

  uint8_t tc_RoundKey[240];

  KeyExpansion(tc_key, tc_RoundKey);

  printf("Input:      ");
  for (int i = 0; i < LONG_SIZE; ++i) {
    printf("%02x", tc_in[i]);
  }
  printf("\n");

  printf("Key:        ");
  for (int i = 0; i < 32; ++i) {
    printf("%02x", tc_key[i]);
  }
  printf("\n");

  for (int i = 0; i < LONG_SIZE; i += 16) {
    AES_Encrypt(tc_in + i, tc_out + i, tc_RoundKey);
  }

  printf("Encrypted:  ");
  for (int i = 0; i < LONG_SIZE; ++i) {
    printf("%02x", tc_out[i]);
  }
  printf("\n");

  for (int i = 0; i < LONG_SIZE; i += 16) {
    AES_Decrypt(tc_out + i, tc_out2 + i, tc_RoundKey);
  }

  printf("Decrypted:  ");
  for (int i = 0; i < LONG_SIZE; ++i) {
    printf("%02x", tc_out2[i]);
  }
  printf("\n\n");

  printf("Data is successfully recovered?   ");
  if (isEqual(tc_in, tc_out2, LONG_SIZE)) {
    printf("YES");
  } else {
    printf("NO");
  }
  printf("\n\n\n");
}

int main(void) {
  uint8_t key[32] = {0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6,
                     0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c,
                     0xa0, 0xfa, 0xfe, 0x17, 0x88, 0x54, 0x2c, 0xb1,
                     0x23, 0xa3, 0x39, 0x39, 0x2a, 0x6c, 0x76, 0x05};

  uint8_t in[16] = {0x48, 0x65, 0x6c, 0x6c, 0x6f, 0x2c, 0x20,
                    0x57, 0x6f, 0x72, 0x6c, 0x64, 0x21};

  printf("Input:      ");
  for (int i = 0; i < 16; ++i) {
    printf("%02x", in[i]);
  }
  printf("\n");

  uint8_t out[16];
  uint8_t out2[16];
  uint8_t RoundKey[240];
  KeyExpansion(key, RoundKey);

  printf("Key:   ");
  for (int i = 0; i < 32; ++i) {
    printf("%02x", key[i]);
  }
  printf("\n");

  AES_Encrypt(in, out, RoundKey);

  printf("Encrypted:  ");
  for (int i = 0; i < 16; ++i) {
    printf("%02x", out[i]);
  }
  printf("\n");

  printf("Decrypted:  ");
  AES_Decrypt(out, out2, RoundKey);
  for (int i = 0; i < 16; ++i) {
    printf("%02x", out2[i]);
  }
  printf("\n");

  printf("Data is successfully recovered?   ");

  if (isEqual(in, out2, 16)) {
    printf("YES");
  } else {
    printf("NO");
  }

  printf("\n\n\n");
  TestCase();
  return 0;
}
